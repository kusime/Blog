---
date: 2021-04-14 20:05:05
updated: 2021-04-14 20:05:05
title: go func 执行过程(如何受调度)
index_img: /gallery/2021-08-23-21-59-40.png
tags: 
  - Golang

categories:
  -  Golang

---

# go func 执行过程(如何受调度)

- `go func`的时候会创建一个 G
- 那么这个时候 G 会
  - 尝试放入 P 的本地队列,如果没满
    - 接下来 P 会尝试获取本地队列中的 G
  - 如果满了
    - 就放入全局队列中
- 在 P 获取到 G 之后就会运行
  - 如果这个运行的 G 发生了阻塞
  - 那么这个时候 P 会和现在绑定的 M 进行分离(这个时候原来的 M 已经和 P 分离,所以这个 M 要么销毁要么添加到睡眠队列中去)
  - 然后去休眠队列里面找一个 M 或者新建一个 M 去和这个 P 绑定以运行本地队列的 P
  - 然后如果 G 终于返回了,那么这个时候它会尝试去寻找一个空闲的本地队列或者是添加到空闲队列

![error_loading](/gallery/2021-04-14-20-17-39.png)