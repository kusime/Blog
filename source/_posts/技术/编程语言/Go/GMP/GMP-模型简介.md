---
date: 2021-04-14 11:28:06
updated: 2021-04-14 11:28:06
title: GMP-模型简介
index_img: /gallery/2021-08-23-21-59-40.png
tags: 
  - Golang

categories:
  -  Golang

---

# 基本符号说明

![error_loading](/gallery/2021-04-14-11-28-54.png)

- G:协程
- P:用来处理协程的,包含运行协程的所有资源(共享进程资源)
- M:物理线程

# 模型介绍

- 模型图

![error_loading](/gallery/2021-04-14-11-37-40.png)

- 模型思维导图

![error_loading](/gallery/2021-04-14-11-37-08.png)

## 本地队列

## 全局队列

## G

- G 是 Goroutine 的缩写，相当于操作系统中的进程控制块(PCB)
- 在这里就是 Goroutine 的控制结构，是对 Goroutine 的抽象。其中包括执行的函数指令及参数
  - G 保存的任务对象
  - 线程上下文切换，现场保护和现场恢复需要的寄存器(SP、IP)

## M

- M 是一个线程或称为 Machine，所有 M 是有线程栈的。
- 如果不对该线程栈提供内存的话，系统会给该线程栈提供内存
- 当指定了线程栈，则 M.stack→G.stack
  - M 的 PC 寄存器指向 G 提供的函数，然后去执行。

## P

- P(Processor)是一个抽象的概念，并不是真正的物理 CPU
- 所以当 P 有任务时需要**创建或者唤醒**一个**系统线程**来执行它队列里的任务
  - 所以 P/M**需要进行绑定**，构成一个执行单元。
- P 决定了同时可以并发任务的数量
  - 通过 GOMAXPROCS 限制同时执行用户级任务的操作系统线程
  - 可以通过 runtime.GOMAXPROCS 进行指定

## P 队列

- 本地队列： 当前 P 的队列，本地队列是 Lock-Free，**没有数据竞争**问题，**无需加锁处理**，可以提升处理速度
- 全局队列：全局队列为了保证多个 P 之间**任务的平衡**。所有**M 共享 P 全局队列**，为保证数据竞争问题，**需要**加锁处理。相比本地队列处理速度要低于全局队列。
