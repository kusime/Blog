---
date: 2021-03-13 13:44:40
updated: 2021-03-13 13:44:40
title: 配置基本流量转发-Openwrt

index_img: /gallery/2021-08-23-20-04-07.png
tags:
  - Openwrt

categories:
  - Openwrt

---


# 前置说明

- 我已经安装好了 openwrt
- 请按照相关文章配置好 openwrt 密码
- 涉及到 linux 路由表
- 涉及到 linux 防火墙

## 基本网络条件

- 我有 USB 网卡
- 树莓派本身网卡
- 树莓派 wifi 网卡
- 有一个千兆交换机
- 两条网线

### 基本网络转发目的

- USB 网卡作为所有流量数据出口
- wifi 作为热点共享
- 有线网卡作为配置树莓路由接口

## 配置基本网卡

### 配置无线网卡热点

- 把树莓派，电脑，都链接到交换机
- 登入树莓派
- 点击无线
- 删除现有的热点
- 新建一个无线网络
- 按照下图的参数来配置，这里是树莓派网卡的极限参数了
  ![error](/gallery/2021-03-13-15-35-34.png)
- 在下图中是选择创建一个，然后我已经创建好的名字叫做 wifi
  ![error](/gallery/2021-03-13-15-36-48.png)

### 配置无线网卡 dhcp 服务

- 进入接口配置页面
- 新建接口

- 下面的网卡选择刚刚创建热点的接口名字
- ![error](/gallery/2021-03-13-15-40-12.png)

- 填完名字和接口后点击下一步
- 如果发现页面有“配置 dhcp”的选项就打开它
- 然后配置本无线网卡的 ip、掩码，广播
  ![error](/gallery/2021-03-13-15-42-55.png)

### 配置有线网卡

- 只要保证没有网桥就好
- 默认树莓派的有线网卡和无线网卡是桥接的
- 把桥接的取消掉，确保各个网卡是独立的
- 默认会分配 192.168.1.0/24 这个网段

### USB 网卡

- 可以进入树莓派查看 usb 网卡的网卡号
- 我的是 Eth1
- 所以直接新建网卡然后选择 DHCP 客户端就好
- ![error_loading](/gallery/2021-03-13-15-50-00.png)

## 配置路由

- 因为期望是所有都从 USB 网卡出去，所以把默认路由出口设置为 eth1 的网关地址
- 可以参考[linux 路由](/posts/linux-route/)去配置对应的默认路由

## 配置 SNAT

- 在此之前确保每个网卡都分配到了防火墙区域
- 就像下面的每个网卡都有一个背景颜色
- ![error_loading](/gallery/2021-03-13-15-57-16.png)
- 配置基本规则
  ![error_loading](/gallery/2021-03-13-15-59-18.png)
- 点击防火墙里面的 “通信规则”
- 把源设置为 WIFI、LAN,目标区域设置为 USB
- 重写 IP 地址为 USB 的 ip 地址
  ![error_loading](/gallery/2021-03-13-16-01-41.png)

## 那么现在你的 wifi，LAN 都可以通过 USB 网卡上网了
