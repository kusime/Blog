---
date: 2021-02-02  15:24:06
updated: 2021-02-02  15:24:06
title:  Linux è·¯ç”±è¡¨
index_img: /gallery/2021-08-23-19-18-20.png
tags:
  - Linux

categories:
  - Linux
---


## Linux kernel route table é…ç½®

### å®˜æ–¹çš„å¸®åŠ©æ–‡æ¡£

```vim
Usage: route [-nNvee] [-FC] [<AF>]           List kernel routing tables
       route [-v] [-FC] {add|del|flush} ...  Modify routing table for AF.

       route {-h|--help} [<AF>]              Detailed usage syntax for specified AF.
       route {-V|--version}                  Display version/author and exit.

        -v, --verbose            be verbose
        -n, --numeric            don't resolve names
        -e, --extend             display other/more information
        -F, --fib                display Forwarding Information Base (default)
        -C, --cache              display routing cache instead of FIB

  <AF>=Use -4, -6, '-A <af>' or '--<af>'; default: inet
  List of possible address families (which support routing):
    inet (DARPA Internet) inet6 (IPv6) ax25 (AMPR AX.25)
    netrom (AMPR NET/ROM) ipx (Novell IPX) ddp (Appletalk DDP)
    x25 (CCITT X.25)

```

## route

æŸ¥çœ‹ä¸Šé¢çš„ä¸œè¥¿å°±å¯ä»¥çŸ¥é“ï¼Œä¸»è¦ç”¨çš„å°±æ˜¯ route å‘½ä»¤çš„ add | del åˆ†æ”¯
ä¹Ÿå°±æ˜¯æ·»åŠ å’Œåˆ é™¤

### route add

#### route add å¸®åŠ©

```vim
inet_route [-vF] add {-host|-net} Target[/prefix] [gw Gw] [metric M]
                       [netmask N] [mss Mss] [window W] [irtt I]
                       [mod] [dyn] [reinstate] [[dev] If]
inet_route [-vF] add {-host|-net} Target[/prefix] [metric M] reject
```

#### route add è¯´æ˜

æŒ‰ç…§ä¸‹é¢çš„å†™å¥½å‚æ•°ï¼ŒåŒ¹é…åˆ°çš„è·¯ç”±è§„åˆ™å°±ä¼šè¢«æ·»åŠ 

### route del

#### route del å¸®åŠ©

```vim
Usage: inet_route [-vF] del {-host|-net} Target[/prefix] [gw Gw] [metric M] [[dev] If]
```

#### route del è¯´æ˜

æŒ‰ç…§ä¸‹é¢çš„å†™å¥½å‚æ•°ï¼ŒåŒ¹é…åˆ°çš„è·¯ç”±è§„åˆ™å°±ä¼šè¢«åˆ é™¤

### å„ä¸ªå‚æ•°çš„è§£é‡Š

#### {-host|-net}

- -host å‚æ•°æŒ‡å®šå¯ä»¥ä¸ªä¸»æœºï¼ŒæŒ‡å®šä¸»æœºçš„æ—¶å€™ä¸éœ€è¦æŒ‡å®šæ© ğŸ‡
- -net å‚æ•°æŒ‡å®šä¸€ä¸ªç½‘æ®µçš„æ‰€æœ‰ä¸»æœº

#### Target[/prefix]

- Target éƒ¨åˆ†ä¸ºæŒ‡å®šçš„ä¸»æœºåœ°å€æˆ–è€…ç½‘æ®µå·ï¼ˆexp. 10.1.0.0 ï¼‰
- [/prefix] éƒ¨åˆ†æŒ‡å®šç½‘æ®µçš„æ© ğŸ‡ ([32/24/16/8] ä¸ºå¸¸ç”¨çš„æ© ğŸ‡ )

#### gw [GW]

- gw è¿™ä¸ªæ˜¯å›ºå®šçš„è¯­æ³•ï¼Œåªè¦æŒ‡å®šç½‘å…³åœ°å€å°±è¦å†™è¿™ä¸ª
- [Gw] è¿™ä¸ªéƒ¨åˆ†æŒ‡å®šç½‘å…³çš„ IP åœ°å€

#### å°æç¤º

ç½‘å…³çš„åœ°å€å¿…é¡»å’ŒæŒ‡å®šçš„ ç½‘æ®µçš„åœ°å€/ä¸»æœºåœ°å€ æ˜¯åœ¨å’Œç½‘å¡åœ°å€åŒä¸€ä¸ªç½‘æ®µä¸Šçš„ï¼Œ  
é»„èŠèŠ±è¯´å°±æ˜¯ç½‘å¡å¿…é¡»è¦å’Œç½‘å…³é€»è¾‘ä¸Šèƒ½ç›´æ¥é€šä¿¡

```bash
sudo route del -net 10.1.0.0/16 gw 192.168.0.1 wlan0 # wlan0_ip: 192.168.0.108
```

ä¸Šé¢çš„è¯­å¥ä¼šè¢«å…è®¸ï¼Œå› ä¸ºç½‘å¡ç†è®ºä¸Šèƒ½å’ŒæŒ‡å®šçš„ç½‘å…³ç›´æ¥è¿›è¡Œé€šä¿¡

```bash
$sudo route del -net 10.1.0.0/16 gw 192.168.1.1 wlan0 # wlan0_ip: 192.168.0.108
SIOCADDRT: Network is unreachable
```

ä¸Šé¢çš„å°±ä¼šå‡ºé”™äº†ï¼Œå› ä¸ºè·¯ç”±åŒ¹é…åˆ°çš„ä¸‹ä¸€è·³ç½‘å¡ä¸èƒ½ç›´æ¥å’Œå¯¹åº”çš„ç½‘å…³é€šä¿¡

æˆ‘ä¸ç¡®å®šæ© ğŸ‡ ä¼šä¸ä¼šå½±å“è¿™ä¸ªæœ€åçš„ç»“æœ  
ä½†æ˜¯æˆ‘çŸ¥é“çš„å°±æ˜¯ 1.1 ä¸å¯ä»¥ç›´æ¥å’Œ 0.1 ç›´æ¥é€šä¿¡çš„

#### metric M

è¿™ä¸ªå…¶å®å°±æ˜¯è®¾å®šä¸€ä¸ªä¼˜å…ˆçº§ï¼ŒM ä¸ºä¸€ä¸ªæ­£æ•´æ•°

- ä¸åŒçš„ç½‘å¡è´¡çŒ®åŒä¸€ä¸ªä¼˜å…ˆçº§æ’åº
- æ¨èæŠŠå®¹æ˜“åŒ¹é…åˆ°çš„æ”¾åœ¨è·¯ç”±è¡¨ä¼˜å…ˆçº§æœ€é«˜çš„ä½ç½®
- æ•°å­—è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šä½

#### [dev]

- å¡«å…¥å¯¹äºçš„ç½‘å¡
- è¿™ä¸ªå¯ä»¥ç†è§£ä¸ºï¼Œç¬¦åˆå¯¹åº”æ¡ä»¶çš„ç½‘å¡èµ°çš„æ˜¯é‚£ä¸ªå‡ºå£
- è·¯ç”±è¡¨çš„ä½œç”¨åœ¨æˆ‘ç†è§£æ¥çœ‹ä¸»è¦å°±æ˜¯åŒ¹é…æ•°æ®å‡ºå£
- LInux è´¡çŒ®æ•°æ®åŒ…æµå…¥æ¥å£

- å› ä¸ºè¾“å…¥å…¥å£æ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œæ‰€ä»¥å°±ç®—æ˜¯ wlan0 å£çš„æ•°æ®æµé‡ï¼Œä¹Ÿå¯ä»¥åŒ¹é…å¯¹åº”çš„ eth0 çš„è·¯ç”±è§„åˆ™
- åœ¨æˆ‘çœ‹æ¥ï¼Œroute è¡¨çš„ä¸»è¦ç›®çš„å°±æ˜¯ä¸ºäº†æŒ‡å®šæ•°æ®æ˜¯ä»é‚£é‡Œå‡ºå»ï¼Œè¿˜æœ‰å°±æ˜¯è·¯ç”±è¡¨ä¸ä¼šä¿®æ”¹æ•°æ®æŠ¥æ–‡
- è·¯ç”±è¡¨åœ¨ iptables çš„ kernel ç©ºé—´å æœ‰ä¸¤ä¸ªåŒ¹é…ä½ç½®ï¼Œåˆ†åˆ«æ˜¯ PREOUTING ä¹‹å å’Œ OUTPUT ä¹‹å‰
- å¯ä»¥ç†è§£ä¸ºè·¯ç”±è¡¨æŒ‡å®šæ•°æ®æ€ä¹ˆèµ°ï¼Ÿèµ°å“ªé‡Œï¼Ÿé˜²ç«å¢™æŒ‡å®šæ•°æ®æµè¦ä¸è¦ï¼Ÿæ”¹ä¸æ”¹ï¼Ÿ

### æ¯”è¾ƒç‰¹æ®Šçš„æƒ…å†µ

#### default

```bash
sudo route add/del default gw [gateway_addr] [dev]
```

è¿™ä¸ª **default** å°±ç›¸å½“äº -net 0.0.0.0/0  
ä»–çš„æ„æ€å°±æ˜¯ä»»æ„åœ°å€éƒ½åŒ¹é…åˆ°è¿™ä¸ªç½‘å…³

å¦‚æœä½¿ç”¨ _default_ çš„æ—¶å€™æ²¡æœ‰æŒ‡å®šå¯¹åº”çš„ç½‘å¡ï¼Œé‚£ä¹ˆ route å‘½ä»¤å°±ä¼šè‡ªåŠ¨åŒ¹é…åˆ°èƒ½å’ŒæŒ‡å®šçš„ç½‘å…³ç›´æ¥é€šä¿¡çš„ç½‘å¡,è€Œä¸”ä¸æŒ‡å®šä¼˜å…ˆçº§çš„æ—¶å€™ï¼Œé»˜è®¤æœ€é«˜ä¼˜å…ˆçº§

```vim
?ã€‹sudo route del -net 0.0.0.0 gw 10.1.0.1 #

ï¼Ÿã€‹route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         10.1.0.1        0.0.0.0         UG    0      0        0 enp7s0
0.0.0.0         192.168.0.1     0.0.0.0         UG    20600  0        0 wlp0s20f3
10.1.0.0        0.0.0.0         255.255.0.0     U     100    0        0 enp7s0
169.254.0.0     0.0.0.0         255.255.0.0     U     1000   0        0 wlp0s20f3
192.168.0.0     0.0.0.0         255.255.255.0   U     600    0        0 wlp0s20f
```

#### route -n

```vim
?>route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         bogon           0.0.0.0         UG    600    0        0 wlp0s20f3
10.1.0.0        0.0.0.0         255.255.0.0     U     100    0        0 enp7s0
link-local      0.0.0.0         255.255.0.0     U     1000   0        0 wlp0s20f3
192.168.0.0     0.0.0.0         255.255.255.0   U     600    0        0 wlp0s20f3

```

å¯ä»¥çœ‹è§ä¸Šé¢æœ‰ä»€ä¹ˆ default blogon çš„å•è¯ä½†ä¸çŸ¥é“å…·ä½“æ˜¯ä»€ä¹ˆåœ°å€ï¼Ÿ

```vim
?>route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.0.1     0.0.0.0         UG    600    0        0 wlp0s20f3
10.1.0.0        0.0.0.0         255.255.0.0     U     100    0        0 enp7s0
169.254.0.0     0.0.0.0         255.255.0.0     U     1000   0        0 wlp0s20f3
192.168.0.0     0.0.0.0         255.255.255.0   U     600    0        0 wlp0s20f3
```

å¯ä»¥çœ‹è§å¯¹åº”å•è¯è¢«æ›¿æ¢æ›¾å…·ä½“çš„ IP åœ°å€äº†ï¼Œä½†æ˜¯æ¯”è¾ƒæœ‰æ„è¯†çš„å°±æ˜¯ route å‘½ä»¤ä¼šå¯¹ default è¿›è¡Œä¸€ä¸ªè§£é‡Šä½†æ˜¯ä¸ä¼šå¯¹ blogon è¿›è¡Œè§£é‡Š  
ï¼ˆæˆ‘ä»¥ä¸ºä»–ä¼šè‡ªåŠ¨è§£é‡Šåˆ°è¿™ä¸ªç½‘ç»œåœ°å€çš„ç½‘å…³åœ°å€ è¿™ä¸ªç†è®ºä¸Šæ¥è¯´æ˜¯å¯ä»¥ä» dhcp çš„ä¿¡æ¯çš„æ¥çš„ï¼‰ ï¼šD

#### SIOCADDRT: Invalid argument

```bash
$sudo route add -net 10.1.0.0  gw 0.0.0.0 netmask 255.255.0.0 enp7s0
SIOCADDRT: Invalid argument
```

å‡ºç°è¿™ä¸ªé—®é¢˜å°±æ˜¯ä½†æˆ‘æƒ³æ·»åŠ ä¸€ä¸ªè·¯ç”±åˆ°è¿™ä¸ªç½‘æ®µï¼Œç„¶åè¡¨ç¤ºè¿™è¿™ä¸ªç½‘æ®µä¸Šçš„æœºå™¨å°±æ˜¯ç›´æ¥è¿æ¥çš„æ—¶å€™å‡ºç°çš„ä¸€ä¸ªé”™è¯¯ï¼Œé‚£ä¹ˆè§£å†³æ–¹æ³•å°±æ˜¯

```bash
sudo route add -net 10.1.0.0  netmask 255.255.0.0 enp7s0
sudo route add -net 10.1.0.0/16 enp7s0
#å¯¹äº/16å’Œ255.255.0.0è¿™ä¸ªæ˜¯ç­‰å­çš„
```

ä¹Ÿå°±æ˜¯è¯´æ·»åŠ ç›´æ¥å¯è¿æ¥çš„è·¯ç”±è§„åˆ™çš„æ—¶å€™æ˜¯ä¸éœ€è¦æŒ‡å®šç½‘å…³ä¸º 0.0.0.0 çš„ å½“ç„¶ï¼Œåé¢çš„è®¾å¤‡ä¹Ÿæ˜¯å¯ä»¥ä¸ç”¨æŒ‡å®šçš„ï¼Œå› ä¸ºè¿™ä¸ªä¼šåŒ¹é…å¯¹åº”çš„ç½‘å¡

å¯¹äºåŒæ ·çš„é—®é¢˜è¿˜å­˜åœ¨åœ¨äºä»¥ä¸‹

```bash
1ï¼š sudo route del -net 10.1.0.0 gw 0.0.0.0 #ä¸æŒ‡å®šç½‘ç»œâ˜¯ğŸ‡
SIOCDELRT: Invalid argument
2ï¼š  sudo route del -net 10.1.0.0 #ä¸æŒ‡å®šç½‘ç»œâ˜¯ğŸ‡
SIOCDELRT: Invalid argument
```

å…¶å®è¿™ä¸ªä¹Ÿä¸éœ€è¦æŒ‡å®šå¯¹åº”çš„ç½‘å…³æ¥è¿›è¡Œä¸€ä¸ªåˆ é™¤ï¼Œåªéœ€è¦åŒ¹é…åˆ°ç½‘ç»œå…»é©¬ï¼Œå’Œå¯¹åº”çš„ç½‘æ®µå·å°±å¯äº†æ‰€ä»¥å¯ä»¥åˆ é™¤å¯¹åº”çš„ç›´è¿è·¯ç”±çš„å‘½ä»¤ä¸º

```bash
1ï¼šsudo route add -net 10.1.0.0/16 enp7s0
2ï¼š sudo route del -net 10.1.0.0 netmask 255.255.0.0
3ï¼šsudo route del -net 10.1.0.0/16 gw 0.0.0.0
4ï¼šsudo route add -net 10.1.0.0/16
```
